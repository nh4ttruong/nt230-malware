## Ôn tập Assembly
[Source](./asm/)

### Bài thực hành 1

Source file ASM đính kèm ***cau1.asm***

**Kết quả thực thi:**

<img src="./media/image1.png" style="width:6.69375in;height:5.86944in" alt="Graphical user interface, text Description automatically generated" />

### Bài thực hành 2

Source file ASM đính kèm ***cau2.asm***

**Kết quả thực thi:**

<img src="./media/image2.png" style="width:6.69375in;height:4.46528in" alt="Không có mô tả." />

### Bài thực hành 3

Source file ASM đính kèm ***cau3.asm***

**Kết quả thực thi:**

<img src="./media/image3.png" style="width:6.69375in;height:3.86389in" alt="A screenshot of a computer Description automatically generated with medium confidence" />

## Chèn mã vào tệp tin PE

### Bài thực hành 4: Thực hiện lại các bước trên thay đổi phần Text là MSSV.
[Source](./NOTEPAD1.4.exe)

Thực hiện thay thế nội dung text thành MSSV:

<img src="./media/image4.png" style="width:6.69375in;height:2.85764in" alt="Graphical user interface, text, application, email Description automatically generated" />

Kết quả từ thay thế:

<img src="./media/image5.png" style="width:5.07242in;height:2.67277in" alt="Graphical user interface, application Description automatically generated" />

### Bài thực hành 5: Bằng cách không tạo thêm vùng nhớ mở rộng vào tập tin PE, tận dụng vùng nhớ trống để chèn chương trình cần chèn trên tập tin Notepad và calc.
[Source](./NOTEPAD1.5.exe)

Đầu tiên, ta thực hiện chọn các địa chỉ để lưu mã hợp ngữ, Caption và Text:

-   **PickAdd**: 0x00010D50

-   **CaptionAdd**: 0x00010D90

-   **TextAdd**: 0x00010DB0

Ta có:

**VAddr_Caption = RawAddCap - SectionRA + SectionVA + ImageBase**

= 0x00010D90 - 0x00008400 + 0x000B000 + 0x01000000

= 0x01013990

-   VAddr_Caption = 0x01013990

**VAddr_Text = RawAddCap - SectionRA + SectionVA + ImageBase**

= 0x00010DB0- 0x00008400 + 0x000B000 + 0x01000000

= 0x000139B0

-   VAddr_Text = 0x010139B0

**new_entry_point = PickAdd - SectionRA + SectionVA + ImageBase**

= 0x00010D50 - 0x00008400 + 0x000B000 + 0x01000000

= 0x01013950

-   new_entry_point = 0x01013950

**jmp_instruction_VA = new_entry_point + 0x14 + ImageBase**

= 0x00013950 + 0x01000000 + 0x14 = 0x01013964

*(0x14 là số bytes của 5 câu lệnh)*

**old_entry_point = jmp_instruction_VA + 5 + relative_VA**

= 0x0100739D

*(là giá trị AddressOfEntryPoint ban đầu đã cộng ImageBase)*

-   **relative_VA = old_entry_point - jmp_instruction_VA - 5**

= 0x0100739D - 0x01013964 - 5

= 0xFFFF3A34

Thay thế các giá trị **VAddr_Caption, VAddr_Text và relative_VA** vào đoạn mã hợp ngữ, ta được:

push 0 ; 6A 00

push Caption ; 68 90390101

push Text ; 68 B0390101

push 0 ; 6A00

call \[MessageBoxW\] ; FF15 68120001

jmp Original_Entry_Point ; e9 343AFFFD

Thực hiện thay thế bằng HxD:

<img src="./media/image6.png" style="width:6.69375in;height:2.38403in" alt="Table Description automatically generated" />

Sử dụng CFF Explorer thực hiện thay đổi AddressOfEntryPoint thành giá trị **0x00013950:**

<img src="./media/image7.png" style="width:6.68391in;height:2.3502in" alt="Table Description automatically generated" />

Save file và kiểm tra kết quả:

<img src="./media/image8.png" style="width:6.69375in;height:2.79236in" alt="Graphical user interface, application Description automatically generated" />
