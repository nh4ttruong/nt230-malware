## Kiểm tra kết nối Internet

Để kiểm tra kết nối Internet, ta sử dụng **HttpWebRequest** để tạo request đến một website bất kỳ. Ta chọn request đến <http://google.com> (timeout = 10000)

<img src="./media/image1.png" style="width:5.97147in;height:2.70045in" alt="Text Description automatically generated" />

Thiết lập **ProjectInstaller** cho service:

<img src="./media/image2.png" style="width:5.9905in;height:1.49964in" alt="A screenshot of a computer Description automatically generated with medium confidence" />

Hàm **CheckInternetConnection** được thực thi qua OnElapsedTime khi service trigger thực thi theo lịch biểu:

<img src="./media/image3.png" style="width:6.00052in;height:1.83349in" alt="Text Description automatically generated" />

Cài đặt service bằng **InstallUtil**:

<img src="./media/image4.png" style="width:6.66357in;height:2.91993in" alt="Text Description automatically generated" />

Kiểm tra services thông qua services.msc:

<img src="./media/image5.png" style="width:5.7292in;height:2.85063in" alt="Graphical user interface, text, application, email Description automatically generated" />

Trên máy cài đặt, ta tắt kết nối Internet và kiểm tra thử bằng lệnh ping:

<img src="./media/image6.png" style="width:5.51756in;height:3.2731in" />

Bật services Lab2-Task3 và theo dõi:

<img src="./media/image7.png" style="width:6.67708in;height:1.05208in" />

Kiểm tra folder Log và file log ta thấy services đã hoạt động:

<img src="./media/image8.png" style="width:6.42852in;height:2.4783in" />

Bật lại kết nối Internet và kiểm tra:

<img src="./media/image9.png" style="width:6.39056in;height:3.81948in" alt="A screenshot of a computer Description automatically generated with medium confidence" />

Kiểm tra lại file log:

<img src="./media/image10.png" style="width:6.72991in;height:3.4833in" alt="Graphical user interface, text Description automatically generated" />

## Đính kèm Reverse Shell

Tạo reverse shell, ta sử dụng **TcpClient** để thiết lập cổng kết nối cho attacker với IP Address và port của attacker. Sử dụng **StreamReader** và **StreamWriter** để đọc và ghi luồng. Sử dụng Process để thiết lập tiến trình kết nối đến **Command Line** của máy nạn nhân cho attacker (**cmd.exe**). Nhóm tham khảo từ website.

<img src="./media/image11.png" style="width:7.01458in;height:4.12841in" alt="Text Description automatically generated" />

<img src="./media/image12.png" style="width:6.95955in;height:2.76895in" alt="Text Description automatically generated" />

Lúc này, khi bật services. OnElapsedTime sẽ kiểm tra kết nối Internet, nếu có, nó thực thi hàm **RevShell()**. Lúc này, ta có thể kết nối với Shell của nạn nhân.

Ta kiểm tra lại IP Address của máy attacker (giả sử attacker sử dụng Kali Linux):

<img src="./media/image13.png" style="width:6.69375in;height:3.51319in" alt="Text Description automatically generated" />

IP Address của attacker: **192.168.12.128**

Services đang chạy, ta bắt đầu connect đến shell từ máy của attacker thông qua command: **sudo nc -lvnp 443:**

<img src="./media/image14.png" style="width:6.69375in;height:3.71528in" alt="A computer screen capture Description automatically generated with medium confidence" />

Kiểm tra **ipconfig** trên máy attacker:

<img src="./media/image15.png" style="width:6.70089in;height:1.67083in" alt="Text Description automatically generated with medium confidence" />

**ipconfig** của máy nạn nhân:

<img src="./media/image16.png" style="width:6.69375in;height:2.02778in" alt="A screenshot of a computer Description automatically generated with medium confidence" />

**RevShell** đã thiết lập thành công!
